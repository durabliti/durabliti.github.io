<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Universal Multiplayer Networking & Server-Authoritative Physics — Full Specification</title>

<style>
:root {
  --bg:#0f1116;
  --panel:#151823;
  --text:#e6e6e6;
  --muted:#9aa0aa;
  --accent:#4da6ff;
  --border:#23273a;
  --code:#0b0d14;
}

* {
  box-sizing:border-box;
  font-family:system-ui,Segoe UI,Arial,sans-serif;
}

html { scroll-behavior:smooth; }

body {
  margin:0;
  display:flex;
  background:var(--bg);
  color:var(--text);
}

nav {
  width:340px;
  height:100vh;
  position:fixed;
  padding:20px;
  background:var(--panel);
  border-right:1px solid var(--border);
  overflow:auto;
}

nav h1 {
  font-size:18px;
  margin-bottom:12px;
}

nav a {
  display:block;
  color:var(--text);
  text-decoration:none;
  padding:6px 0;
  font-size:14px;
}

nav a:hover { color:var(--accent); }

main {
  margin-left:340px;
  padding:50px;
  max-width:1300px;
}

section { margin-bottom:120px; }

h2 {
  border-bottom:1px solid var(--border);
  padding-bottom:6px;
  margin-top:80px;
}

h3 { margin-top:50px; }

p {
  line-height:2.0;
  color:var(--muted);
  margin:18px 0;
}

ul { margin-left:25px; }

pre {
  background:var(--code);
  padding:20px;
  border-radius:6px;
  overflow:auto;
  font-size:14px;
}

.note {
  border-left:4px solid var(--accent);
  padding:18px;
  margin:30px 0;
  background:var(--panel);
}
</style>
</head>

<body>

<nav>
<h1>Universal Multiplayer Spec</h1>
<a href="#intro">Введение</a>
<a href="#goals">Цели</a>
<a href="#architecture">Архитектура</a>
<a href="#threat">Модель угроз</a>
<a href="#tick">Tick-система</a>
<a href="#input">Input модель</a>
<a href="#physics">Server Physics</a>
<a href="#collision">Коллизии</a>
<a href="#sync">Синхронизация</a>
<a href="#interest">Interest Management</a>
<a href="#anticheat">Anti-Cheat</a>
<a href="#example">Reference Implementation</a>
<a href="#playit">Playit / NAT</a>
<a href="#mistakes">Типичные ошибки</a>
<a href="#conclusion">Заключение</a>
</nav>

<main>

<section id="intro">
<h2>Введение</h2>
<p>
Этот документ является полной спецификацией универсальной
клиент-серверной архитектуры для мультиплеерных игр,
симуляторов и realtime-приложений.
</p>
<p>
В основе лежит принцип <b>server-authoritative simulation</b>,
при котором сервер является единственным источником истины
для всех аспектов состояния мира.
</p>
</section>

<section id="goals">
<h2>Цели системы</h2>
<ul>
<li>Исключить доверие к клиенту</li>
<li>Обеспечить детерминированную симуляцию</li>
<li>Минимизировать возможности читинга</li>
<li>Масштабироваться от 2 до тысяч клиентов</li>
<li>Оставаться движок-независимой</li>
</ul>
</section>

<section id="architecture">
<h2>Архитектура</h2>
<pre>
Client (Input only)
   ↓
RPC / Input Stream
   ↓
Server
   ↓
Physics + Logic + Validation
   ↓
Authoritative State
   ↓
Clients (Visualization)
</pre>

<p>
Клиент — исключительно источник ввода.
Любая попытка передать состояние мира игнорируется.
</p>
</section>

<section id="threat">
<h2>Модель угроз</h2>
<p>
Система проектируется с учётом того, что клиент может быть полностью
скомпрометирован.
</p>
<ul>
<li>Подмена пакетов</li>
<li>Speed hack</li>
<li>Teleport hack</li>
<li>Memory editing</li>
<li>Packet replay</li>
</ul>

<div class="note">
Единственный способ защиты — не принимать от клиента ничего,
кроме намерений.
</div>
</section>

<section id="tick">
<h2>Tick-based симуляция</h2>
<p>
Сервер работает в дискретных шагах — ticks.
Каждый tick имеет фиксированную длительность.
</p>

<pre>
TICK_RATE = 60
DT = 1 / TICK_RATE
</pre>

<p>
Все физические и логические расчёты происходят строго в рамках tick.
</p>
</section>

<section id="input">
<h2>Input модель</h2>
<p>
Клиент отправляет только ввод:
</p>
<ul>
<li>направление движения</li>
<li>нажатие кнопок</li>
<li>активацию действий</li>
</ul>

<pre>
InputPacket {
  tick
  moveX
  moveY
  actions
}
</pre>

<p>
Сервер буферизует ввод и применяет его строго по tick.
</p>
</section>

<section id="physics">
<h2>Server-Authoritative Physics</h2>
<p>
Физика рассчитывается исключительно на сервере:
</p>
<ul>
<li>ускорение</li>
<li>гравитация</li>
<li>ограничения скорости</li>
<li>трение</li>
</ul>

<pre>
// Physics integration
velocity += acceleration * dt
position += velocity * dt
</pre>

<div class="note">
Клиент никогда не сообщает результат движения.
</div>
</section>

<section id="collision">
<h2>Коллизии</h2>
<p>
Коллизии являются частью серверной симуляции.
</p>

<pre>
if (world.intersects(entity.bounds)) {
  entity.position = entity.lastValidPosition
  entity.velocity = vec3(0,0,0)
}
</pre>
</section>

<section id="sync">
<h2>Синхронизация состояния</h2>
<p>
Сервер отправляет authoritative state:
</p>
<ul>
<li>позиции</li>
<li>скорости</li>
<li>состояния</li>
</ul>

<p>
Клиент:
</p>
<ul>
<li>интерполирует</li>
<li>корректирует</li>
<li>визуализирует</li>
</ul>
</section>

<section id="interest">
<h2>Interest Management</h2>
<p>
Для масштабирования сервер отправляет клиенту
только релевантные сущности.
</p>

<pre>
if (distance(player, entity) < VIEW_RADIUS)
  send(entity)
</pre>
</section>

<section id="anticheat">
<h2>Anti-Cheat архитектура</h2>
<ul>
<li>Rate limiting RPC</li>
<li>Distance validation</li>
<li>Server cooldowns</li>
<li>Input sanity checks</li>
</ul>

<div class="note">
Античит — это архитектура, а не модуль.
</div>
</section>

<section id="example">
<h2>Reference Server Loop</h2>

<pre>
function serverTick(dt) {
  collectInputs()
  applyPhysics(dt)
  resolveCollisions()
  validateState()
  broadcastState()
}
</pre>

<p>
Этот цикл является сердцем системы.
</p>
</section>

<section id="playit">
<h2>Playit.gg, NAT и публикация</h2>
<p>
Playit используется для публикации сервера,
находящегося за NAT или без публичного IP.
</p>

<pre>
Client → Playit Public Endpoint → Tunnel → Local Server
</pre>

<p>
Playit решает проблему доступности,
но не заменяет безопасность сервера.
</p>
</section>

<section id="mistakes">
<h2>Типичные ошибки</h2>
<ul>
<li>Передача позиции от клиента</li>
<li>Клиентская физика</li>
<li>Отсутствие tick-системы</li>
<li>Отсутствие валидации</li>
</ul>
</section>

<section id="conclusion">
<h2>Заключение</h2>
<p>
Эта архитектура является фундаментом
для безопасных и масштабируемых мультиплеерных систем.
</p>

<div class="note">
Если сервер не авторитет — это не мультиплеер.
</div>
</section>

</main>
</body>
</html>
