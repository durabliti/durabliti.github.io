<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Universal Multiplayer RPC Specification</title>

<style>
:root {
  --bg:#0f1116;
  --panel:#151823;
  --text:#e6e6e6;
  --muted:#9aa0aa;
  --accent:#4da6ff;
  --border:#23273a;
  --code:#0b0d14;
}

* {
  box-sizing:border-box;
  font-family:system-ui,Segoe UI,Arial,sans-serif;
}

html { scroll-behavior:smooth; }

body {
  margin:0;
  display:flex;
  background:var(--bg);
  color:var(--text);
}

/* SIDEBAR */
nav {
  width:280px;
  height:100vh;
  position:fixed;
  padding:20px;
  background:var(--panel);
  border-right:1px solid var(--border);
  overflow:auto;
}

nav h1 {
  font-size:18px;
  margin:0 0 10px;
}

nav a {
  display:block;
  padding:6px 0;
  font-size:14px;
  color:var(--text);
  text-decoration:none;
}

nav a:hover { color:var(--accent); }

/* CONTENT */
main {
  margin-left:280px;
  padding:40px;
  max-width:1100px;
}

section { margin-bottom:70px; }

h2 {
  border-bottom:1px solid var(--border);
  padding-bottom:6px;
  margin-top:50px;
}

h3 { margin-top:30px; }

p { line-height:1.7; color:var(--muted); }

pre {
  background:var(--code);
  padding:16px;
  border-radius:6px;
  overflow:auto;
  font-size:14px;
}

table {
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
}

th,td {
  border:1px solid var(--border);
  padding:8px;
  text-align:left;
}

th { background:var(--panel); }

.note {
  border-left:4px solid var(--accent);
  padding:12px;
  margin:20px 0;
  background:var(--panel);
}
</style>
</head>

<body>

<nav>
<h1>Multiplayer RPC</h1>
<a href="#intro">Введение</a>
<a href="#terms">Термины</a>
<a href="#architecture">Архитектура</a>
<a href="#protocol">Протокол</a>
<a href="#lifecycle">Lifecycle</a>
<a href="#rpc">RPC контракт</a>
<a href="#state">State Sync</a>
<a href="#prediction">Prediction</a>
<a href="#errors">Ошибки</a>
<a href="#security">Безопасность</a>
<a href="#scaling">Масштабирование</a>
</nav>

<main>

<section id="intro">
<h2>Введение</h2>
<p>
Этот документ описывает универсальную клиент-серверную модель
мультиплеера с серверным авторитетом.
Подходит для игр, симуляторов и realtime-приложений.
</p>
<div class="note">
Клиент считается недоверенным по умолчанию.
</div>
</section>

<section id="terms">
<h2>Термины</h2>
<table>
<tr><th>Термин</th><th>Описание</th></tr>
<tr><td>Client</td><td>Источник ввода, не владеет состоянием</td></tr>
<tr><td>Server</td><td>Единственный авторитет</td></tr>
<tr><td>Entity</td><td>Объект мира</td></tr>
<tr><td>RPC</td><td>Удалённый запрос действия</td></tr>
<tr><td>Snapshot</td><td>Полное состояние мира</td></tr>
<tr><td>Delta</td><td>Изменение состояния</td></tr>
<tr><td>Tick</td><td>Шаг симуляции</td></tr>
</table>
</section>

<section id="architecture">
<h2>Архитектура</h2>
<pre>
Client ──RPC──▶ Server
Client ◀─State─ Server
</pre>
<ul>
<li>Сервер владеет логикой</li>
<li>Клиент отправляет намерения</li>
<li>Сервер решает результат</li>
</ul>
</section>

<section id="protocol">
<h2>Формат протокола</h2>
<pre>
{
  "type": "handshake | rpc | state | error",
  "clientId": 0,
  "seq": 0,
  "tick": 0,
  "payload": {}
}
</pre>
</section>

<section id="lifecycle">
<h2>Lifecycle соединения</h2>
<pre>
CONNECT
 ↓
HANDSHAKE
 ↓
AUTH
 ↓
SPAWN
 ↓
SYNC LOOP
 ↓
DISCONNECT
</pre>
</section>

<section id="rpc">
<h2>RPC контракт</h2>

<h3>Client → Server</h3>
<table>
<tr><th>RPC</th><th>Описание</th></tr>
<tr><td>Move</td><td>Запрос перемещения</td></tr>
<tr><td>Action</td><td>Использование способности</td></tr>
<tr><td>Interact</td><td>Взаимодействие</td></tr>
</table>

<h3>Server → Client</h3>
<table>
<tr><th>RPC</th><th>Описание</th></tr>
<tr><td>Spawn</td><td>Создание сущности</td></tr>
<tr><td>Update</td><td>Обновление состояния</td></tr>
<tr><td>Despawn</td><td>Удаление</td></tr>
</table>
</section>

<section id="state">
<h2>Синхронизация состояния</h2>
<p>Используются два режима:</p>
<ul>
<li>Snapshot — восстановление</li>
<li>Delta — основной поток</li>
</ul>

<pre>
State {
  entityId
  position
  rotation
  velocity
}
</pre>
</section>

<section id="prediction">
<h2>Prediction & Reconciliation</h2>
<ul>
<li>Клиент применяет ввод локально</li>
<li>Хранит историю input</li>
<li>Сервер присылает authoritative state</li>
<li>Клиент корректирует расхождения</li>
</ul>
</section>

<section id="errors">
<h2>Ошибки</h2>
<pre>
{
  "type": "error",
  "code": "INVALID_RPC",
  "message": "Move vector too large"
}
</pre>
</section>

<section id="security">
<h2>Безопасность</h2>
<ul>
<li>Rate limiting RPC</li>
<li>Server-side physics</li>
<li>Distance checks</li>
<li>Cooldown validation</li>
</ul>
<div class="note">
Логика на клиенте ≠ защита
</div>
</section>

<section id="scaling">
<h2>Масштабирование</h2>
<ul>
<li>Interest management</li>
<li>World sharding</li>
<li>Tick decoupling</li>
<li>Region-based sync</li>
</ul>
</section>

</main>
</body>
</html>
